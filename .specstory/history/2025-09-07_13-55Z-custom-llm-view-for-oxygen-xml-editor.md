<!-- Generated by SpecStory -->

# Custom LLM View for Oxygen XML Editor (2025-09-07 13:55Z)

_**User (2025-09-07 13:56Z)**_

how to utilize JavaScript-Based Workspace Access Plugin Extension to develop a custom view empowered by LLM for Oxygen XML Editor?

https://www.oxygenxml.com/doc/versions/27.1/ug-editor/topics/workspace-access-plugin-js.html

---

_**Assistant**_

To develop a custom view empowered by LLM for Oxygen XML Editor using the JavaScript-Based Workspace Access Plugin Extension, you'll need to create a plugin that integrates with both Oxygen's API and an LLM service. Here's how to approach this:

## 1. Plugin Structure Setup

````javascript
// Main plugin entry point
function createLLMView() {
    const viewID = "llm-assistant-view";
    
    // Create the custom view
    const view = {
        id: viewID,
        title: "LLM Assistant",
        type: "dockable",
        location: "right",
        content: createLLMViewContent()
    };
    
    // Register the view with Oxygen
    workspace.getViewManager().addView(view);
    
    return view;
}

function createLLMViewContent() {
    // Create HTML content for the view
    const container = document.createElement('div');
    container.className = 'llm-assistant-container';
    container.innerHTML = `
        <div class="llm-input-section">
            <textarea id="llm-prompt" placeholder="Ask about your XML content..."></textarea>
            <button id="llm-submit">Ask LLM</button>
        </div>
        <div class="llm-output-section">
            <div id="llm-response"></div>
        </div>
    `;
    
    // Add event listeners
    setupEventListeners(container);
    
    return container;
}
````

## 2. LLM Integration Module

````javascript
class LLMIntegration {
    constructor(apiKey, endpoint) {
        this.apiKey = apiKey;
        this.endpoint = endpoint;
    }
    
    async queryLLM(prompt, context = '') {
        try {
            const response = await fetch(this.endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo', // or your preferred model
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an XML editing assistant. Help users with XML structure, validation, and content analysis.'
                        },
                        {
                            role: 'user',
                            content: `Context: ${context}\n\nQuestion: ${prompt}`
                        }
                    ]
                })
            });
            
            const data = await response.json();
            return data.choices[0].message.content;
        } catch (error) {
            console.error('LLM API Error:', error);
            return 'Error communicating with LLM service.';
        }
    }
}
````

## 3. XML Context Extraction

````javascript
function extractXMLContext() {
    // Get current editor content
    const editor = workspace.getEditorAccess();
    if (!editor) return '';
    
    try {
        // Get selected text or current element context
        const selection = editor.getSelectionText();
        if (selection) {
            return selection;
        }
        
        // Get current element and its context
        const caretOffset = editor.getCaretOffset();
        const document = editor.getDocument();
        const rootElement = document.getRootElement();
        
        // Extract surrounding context (simplified)
        const contextRange = 500; // characters
        const startOffset = Math.max(0, caretOffset - contextRange);
        const endOffset = Math.min(document.getLength(), caretOffset + contextRange);
        
        return document.getText(startOffset, endOffset - startOffset);
    } catch (error) {
        console.error('Error extracting XML context:', error);
        return '';
    }
}

function getCurrentElementInfo() {
    const editor = workspace.getEditorAccess();
    if (!editor) return null;
    
    try {
        const caretOffset = editor.getCaretOffset();
        const node = editor.getNodeAtOffset(caretOffset);
        
        return {
            nodeName: node.getNodeName(),
            nodeType: node.getNodeType(),
            attributes: getNodeAttributes(node),
            textContent: node.getTextContent()
        };
    } catch (error) {
        console.error('Error getting current element info:', error);
        return null;
    }
}
````

## 4. Event Handling and UI Logic

````javascript
function setupEventListeners(container) {
    const submitButton = container.querySelector('#llm-submit');
    const promptTextarea = container.querySelector('#llm-prompt');
    const responseDiv = container.querySelector('#llm-response');
    
    // Initialize LLM integration
    const llm = new LLMIntegration(
        getPluginSetting('llm_api_key'),
        getPluginSetting('llm_endpoint')
    );
    
    submitButton.addEventListener('click', async () => {
        const prompt = promptTextarea.value.trim();
        if (!prompt) return;
        
        // Show loading state
        responseDiv.innerHTML = 'Thinking...';
        submitButton.disabled = true;
        
        try {
            // Extract XML context
            const xmlContext = extractXMLContext();
            const elementInfo = getCurrentElementInfo();
            
            // Prepare context for LLM
            const context = `
                Current XML Context: ${xmlContext}
                Current Element: ${elementInfo ? elementInfo.nodeName : 'Unknown'}
                Element Attributes: ${elementInfo ? JSON.stringify(elementInfo.attributes) : 'None'}
            `;
            
            // Query LLM
            const response = await llm.queryLLM(prompt, context);
            
            // Display response with formatting
            responseDiv.innerHTML = formatLLMResponse(response);
            
        } catch (error) {
            responseDiv.innerHTML = `Error: ${error.message}`;
        } finally {
            submitButton.disabled = false;
        }
    });
    
    // Handle Enter key in textarea
    promptTextarea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
            submitButton.click();
        }
    });
}
````

## 5. Plugin Configuration

````javascript
// Plugin configuration and initialization
const pluginConfig = {
    id: 'llm-assistant-plugin',
    version: '1.0.0',
    name: 'LLM Assistant for XML',
    description: 'AI-powered assistant for XML editing and analysis'
};

// Plugin settings
const defaultSettings = {
    llm_api_key: '',
    llm_endpoint: 'https://api.openai.com/v1/chat/completions',
    auto_context: true,
    max_context_length: 1000
};

function initializePlugin() {
    // Load settings
    loadPluginSettings();
    
    // Create and register the custom view
    createLLMView();
    
    // Add menu items
    addMenuItems();
    
    // Register keyboard shortcuts
    registerShortcuts();
}

function addMenuItems() {
    const menuManager = workspace.getMenuManager();
    
    menuManager.addMenuItem('Tools', {
        text: 'LLM Assistant',
        action: () => {
            workspace.getViewManager().showView('llm-assistant-view');
        }
    });
}
````

## 6. Utility Functions

````javascript
function formatLLMResponse(response) {
    // Convert markdown-like formatting to HTML
    return response
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
        .replace(/\n/g, '<br>');
}

function getPluginSetting(key) {
    // Get setting from Oxygen's preferences
    return workspace.getPreferences().getGlobalPreference(
        `llm.assistant.${key}`, 
        defaultSettings[key]
    );
}

function setPluginSetting(key, value) {
    workspace.getPreferences().setGlobalPreference(
        `llm.assistant.${key}`, 
        value
    );
}

function getNodeAttributes(node) {
    const attributes = {};
    if (node && node.getAttributes) {
        const attrs = node.getAttributes();
        for (let i = 0; i < attrs.getLength(); i++) {
            const attr = attrs.item(i);
            attributes[attr.getName()] = attr.getValue();
        }
    }
    return attributes;
}
````

## 7. CSS Styling

````css
.llm-assistant-container {
    padding: 10px;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.llm-input-section {
    margin-bottom: 10px;
}

#llm-prompt {
    width: 100%;
    height: 80px;
    margin-bottom: 5px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    resize: vertical;
}

#llm-submit {
    width: 100%;
    padding: 8px;
    background-color: #007acc;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#llm-submit:hover {
    background-color: #005a9e;
}

#llm-submit:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}

.llm-output-section {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 10px;
    background-color: #f9f9f9;
}
````

## Key Features of This Implementation:

1. **Custom Dockable View**: Creates a dedicated panel for LLM interaction
2. **Context Awareness**: Automatically extracts XML context from the current editor
3. **LLM Integration**: Connects to external LLM APIs (OpenAI, etc.)
4. **Real-time Interaction**: Provides immediate feedback and assistance
5. **Extensible Architecture**: Easy to add new features and LLM providers

To deploy this plugin, package these files according to Oxygen's plugin structure and configure the LLM API credentials through the plugin settings.

---

_**User (2025-09-07 13:58Z)**_

what's the project structure for the above sample?

---

_**Assistant**_

Here's the complete project structure for the JavaScript-Based Workspace Access Plugin Extension for Oxygen XML Editor:

## Project Structure

```
llm-assistant-plugin/
├── plugin.xml                     # Plugin descriptor file
├── plugin.js                      # Main plugin entry point
├── src/
│   ├── js/
│   │   ├── llm-integration.js      # LLM API integration
│   │   ├── xml-context.js          # XML content extraction
│   │   ├── event-handlers.js       # UI event handling
│   │   ├── plugin-config.js        # Configuration management
│   │   └── utils.js               # Utility functions
│   ├── css/
│   │   └── llm-assistant.css      # Styling for the custom view
│   └── html/
│       └── settings.html          # Settings dialog (optional)
├── resources/
│   ├── icons/
│   │   ├── llm-icon-16.png       # 16x16 icon
│   │   ├── llm-icon-24.png       # 24x24 icon
│   │   └── llm-icon-32.png       # 32x32 icon
│   └── i18n/
│       ├── messages_en.properties # English translations
│       └── messages_de.properties # German translations (optional)
├── lib/                           # External dependencies (if any)
├── docs/
│   ├── README.md                  # Plugin documentation
│   ├── INSTALLATION.md            # Installation guide
│   └── API.md                     # API documentation
├── tests/
│   ├── test-runner.html           # Test runner
│   └── unit-tests.js              # Unit tests
└── package.json                   # Node.js package file (optional)
```

## Core Files Content

### 1. Plugin Descriptor (plugin.xml)

````xml
<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://www.oxygenxml.com/ns/extension"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.oxygenxml.com/ns/extension 
                           http://www.oxygenxml.com/ns/extension/extensions.xsd">
    
    <name>LLM Assistant Plugin</name>
    <description>AI-powered assistant for XML editing and analysis</description>
    <version>1.0.0</version>
    <vendor>Your Company</vendor>
    <license>MIT</license>
    
    <extension type="WorkspaceAccess" class="JSWorkspaceAccess">
        <js href="plugin.js"/>
        <css href="src/css/llm-assistant.css"/>
    </extension>
    
    <extension type="CustomViewProvider" class="JSCustomViewProvider">
        <js href="plugin.js"/>
    </extension>
    
</plugin>
````

### 2. Main Plugin Entry (plugin.js)

````javascript
// Import all module files
importScript('src/js/llm-integration.js');
importScript('src/js/xml-context.js');
importScript('src/js/event-handlers.js');
importScript('src/js/plugin-config.js');
importScript('src/js/utils.js');

// Plugin lifecycle hooks
const LLMAssistantPlugin = {
    // Called when plugin is loaded
    applicationStarted: function(pluginWorkspaceAccess) {
        this.workspace = pluginWorkspaceAccess;
        
        // Initialize the plugin
        initializePlugin();
        
        // Set up workspace listeners
        this.setupWorkspaceListeners();
    },
    
    // Called when application is closing
    applicationClosing: function() {
        // Cleanup resources
        this.cleanup();
    },
    
    setupWorkspaceListeners: function() {
        // Listen for editor changes
        this.workspace.addEditorChangeListener({
            editorOpened: function(editorLocation) {
                console.log('Editor opened:', editorLocation);
            },
            editorClosed: function(editorLocation) {
                console.log('Editor closed:', editorLocation);
            }
        });
    },
    
    cleanup: function() {
        // Perform cleanup tasks
        console.log('LLM Assistant Plugin cleanup');
    }
};

// Export plugin instance
if (typeof module !== 'undefined' && module.exports) {
    module.exports = LLMAssistantPlugin;
}
````

### 3. Configuration Management

````javascript
const PluginConfig = {
    // Plugin metadata
    metadata: {
        id: 'llm-assistant-plugin',
        version: '1.0.0',
        name: 'LLM Assistant for XML',
        description: 'AI-powered assistant for XML editing and analysis'
    },
    
    // Default settings
    defaultSettings: {
        llm_provider: 'openai',
        llm_api_key: '',
        llm_endpoint: 'https://api.openai.com/v1/chat/completions',
        llm_model: 'gpt-3.5-turbo',
        auto_context: true,
        max_context_length: 1000,
        view_position: 'right',
        enable_shortcuts: true
    },
    
    // Supported LLM providers
    providers: {
        openai: {
            name: 'OpenAI',
            endpoint: 'https://api.openai.com/v1/chat/completions',
            models: ['gpt-3.5-turbo', 'gpt-4', 'gpt-4-turbo']
        },
        anthropic: {
            name: 'Anthropic Claude',
            endpoint: 'https://api.anthropic.com/v1/messages',
            models: ['claude-3-sonnet', 'claude-3-opus']
        },
        local: {
            name: 'Local LLM',
            endpoint: 'http://localhost:11434/api/chat',
            models: ['llama2', 'codellama']
        }
    }
};

function initializePlugin() {
    // Load user settings
    loadPluginSettings();
    
    // Create and register the custom view
    createLLMView();
    
    // Add menu items and toolbar
    setupMenuItems();
    
    // Register keyboard shortcuts
    if (getPluginSetting('enable_shortcuts')) {
        registerKeyboardShortcuts();
    }
    
    console.log('LLM Assistant Plugin initialized');
}

function setupMenuItems() {
    // Add to Tools menu
    workspace.getMenuManager().addMenuItem('Tools', {
        text: 'LLM Assistant',
        description: 'Show LLM Assistant panel',
        icon: 'resources/icons/llm-icon-16.png',
        action: function() {
            workspace.getViewManager().showView('llm-assistant-view');
        }
    });
    
    // Add submenu for settings
    workspace.getMenuManager().addMenuItem('Tools/LLM Assistant', {
        text: 'Settings',
        action: function() {
            showSettingsDialog();
        }
    });
}
````

### 4. Package Configuration (package.json)

````json
{
  "name": "oxygen-llm-assistant-

---

