<!-- Generated by SpecStory -->

# Developing LLM-Powered Custom View for Oxygen XML Editor (2025-09-07 13:48Z)

_**User (2025-09-07 13:51Z)**_

how to utilize JavaScript-Based Workspace Access Plugin Extension to develop a custom view empowered by LLM for Oxygen XML Editor?

https://www.oxygenxml.com/doc/versions/27.1/ug-editor/topics/workspace-access-plugin-js.html

---

_**Assistant**_

Based on your current setup with Ollama and the Oxygen XML Editor documentation, here's how you can develop a custom LLM-powered view using the JavaScript-Based Workspace Access Plugin Extension:

## 1. Plugin Structure Setup

First, create the basic plugin structure:

````javascript
// Main plugin entry point
function createCustomView() {
    // Create a custom view panel
    var customView = workspace.createDockableView("llm-assistant", "LLM Assistant", "WEST");
    
    // Create HTML content for the view
    var htmlContent = `
        <div style="padding: 10px;">
            <h3>LLM Document Assistant</h3>
            <textarea id="promptInput" placeholder="Enter your prompt here..." 
                      style="width: 100%; height: 100px; margin-bottom: 10px;"></textarea>
            <button id="processBtn" onclick="processWithLLM()">Process with LLM</button>
            <div id="results" style="margin-top: 10px; border: 1px solid #ccc; padding: 10px; min-height: 100px;">
                Results will appear here...
            </div>
        </div>
    `;
    
    customView.setContent(htmlContent);
    return customView;
}
````

## 2. LLM Integration Functions

````javascript
// LLM communication functions
var OLLAMA_URL = "http://172.27.2.129:11434/api/generate";

function callOllama(prompt, model) {
    model = model || "gemma2:27b"; // Use available model from your tags check
    
    var payload = {
        "model": model,
        "prompt": prompt,
        "stream": false
    };
    
    try {
        var response = Java.type("java.net.http.HttpClient").newHttpClient()
            .send(
                Java.type("java.net.http.HttpRequest").newBuilder()
                    .uri(Java.type("java.net.URI").create(OLLAMA_URL))
                    .header("Content-Type", "application/json")
                    .POST(Java.type("java.net.http.HttpRequest$BodyPublishers")
                        .ofString(JSON.stringify(payload)))
                    .build(),
                Java.type("java.net.http.HttpResponse$BodyHandlers").ofString()
            );
        
        var responseData = JSON.parse(response.body());
        return responseData.response || "No response received";
    } catch (e) {
        return "Error: " + e.message;
    }
}

function processWithLLM() {
    var promptInput = document.getElementById("promptInput");
    var resultsDiv = document.getElementById("results");
    var prompt = promptInput.value.trim();
    
    if (!prompt) {
        resultsDiv.innerHTML = "Please enter a prompt.";
        return;
    }
    
    resultsDiv.innerHTML = "Processing...";
    
    // Get current document context
    var currentDoc = workspace.getCurrentEditorAccess();
    var documentContent = "";
    
    if (currentDoc) {
        documentContent = currentDoc.getDocumentController().getDocument().getText();
        prompt = "Context: " + documentContent.substring(0, 1000) + "\n\nQuery: " + prompt;
    }
    
    // Call LLM asynchronously
    setTimeout(function() {
        var result = callOllama(prompt);
        resultsDiv.innerHTML = "<pre>" + result + "</pre>";
    }, 100);
}
````

## 3. Plugin Descriptor

````xml
<?xml version="1.0" encoding="UTF-8"?>
<plugin id="llm-assistant" name="LLM Assistant" 
        description="LLM-powered document assistant for Oxygen XML Editor" 
        version="1.0.0" vendor="Your Company" class="LLMAssistantPlugin">
    
    <runtime>
        <library name="plugin.js"/>
        <library name="llm-integration.js"/>
    </runtime>
    
    <extension type="WorkspaceAccess" class="LLMWorkspaceAccessPlugin"/>
</plugin>
````

## 4. Workspace Access Plugin Class

````javascript
// Main workspace access plugin implementation
var LLMWorkspaceAccessPlugin = Java.extend(Java.type("ro.sync.exml.workspace.api.standalone.StandalonePluginWorkspace"), {
    
    applicationStarted: function(workspaceAccessPluginExtension) {
        // Initialize when application starts
        this.initializeLLMView();
        this.setupMenuActions();
    },
    
    initializeLLMView: function() {
        // Create and register the custom view
        var customView = createCustomView();
        workspace.addViewComponentCustomizer(function(viewInfo) {
            if (viewInfo.getViewID() === "llm-assistant") {
                return customView;
            }
            return null;
        });
    },
    
    setupMenuActions: function() {
        // Add menu items for LLM functions
        var menuBar = workspace.getMenuBarCustomizer();
        
        menuBar.customizeMainMenu(function(mainMenuBar) {
            var llmMenu = new Java.type("javax.swing.JMenu")("LLM Tools");
            
            // Add "Summarize Document" action
            var summarizeAction = new Java.type("javax.swing.AbstractAction")("Summarize Document") {
                actionPerformed: function(e) {
                    summarizeCurrentDocument();
                }
            };
            llmMenu.add(summarizeAction);
            
            // Add "Explain XML Structure" action
            var explainAction = new Java.type("javax.swing.AbstractAction")("Explain XML Structure") {
                actionPerformed: function(e) {
                    explainXMLStructure();
                }
            };
            llmMenu.add(explainAction);
            
            mainMenuBar.add(llmMenu);
        });
    }
});

function summarizeCurrentDocument() {
    var currentDoc = workspace.getCurrentEditorAccess();
    if (currentDoc) {
        var content = currentDoc.getDocumentController().getDocument().getText();
        var prompt = "Please provide a concise summary of this XML document:\n\n" + content;
        var summary = callOllama(prompt);
        
        // Show result in a dialog
        workspace.showInformationMessage("Document Summary", summary);
    }
}

function explainXMLStructure() {
    var currentDoc = workspace.getCurrentEditorAccess();
    if (currentDoc) {
        var content = currentDoc.getDocumentController().getDocument().getText();
        var prompt = "Explain the structure and purpose of this XML document:\n\n" + content;
        var explanation = callOllama(prompt);
        
        workspace.showInformationMessage("XML Structure Explanation", explanation);
    }
}
````

## 5. Enhanced Features

````javascript
// Advanced LLM-powered features

function validateXMLWithLLM() {
    var currentDoc = workspace.getCurrentEditorAccess();
    if (currentDoc) {
        var content = currentDoc.getDocumentController().getDocument().getText();
        var prompt = "Analyze this XML for potential issues, validation problems, or improvements:\n\n" + content;
        var analysis = callOllama(prompt);
        
        // Create a new document with the analysis
        var newDoc = workspace.createNewDocument();
        newDoc.getDocumentController().getDocument().setText(analysis);
    }
}

function generateSchemaFromXML() {
    var currentDoc = workspace.getCurrentEditorAccess();
    if (currentDoc) {
        var content = currentDoc.getDocumentController().getDocument().getText();
        var prompt = "Generate an XSD schema for this XML document:\n\n" + content;
        var schema = callOllama(prompt);
        
        var newDoc = workspace.createNewDocument();
        newDoc.getDocumentController().getDocument().setText(schema);
    }
}

function convertXMLFormat() {
    var currentDoc = workspace.getCurrentEditorAccess();
    if (currentDoc) {
        var content = currentDoc.getDocumentController().getDocument().getText();
        var targetFormat = workspace.showInputDialog("Convert to which format?", "JSON");
        
        if (targetFormat) {
            var prompt = `Convert this XML to ${targetFormat} format:\n\n${content}`;
            var converted = callOllama(prompt);
            
            var newDoc = workspace.createNewDocument();
            newDoc.getDocumentController().getDocument().setText(converted);
        }
    }
}
````

## 6. Installation and Configuration

To deploy this plugin:

1. **Package the plugin** by creating a JAR file with all JavaScript files
2. **Install in Oxygen** by copying to the plugins directory
3. **Configure the LLM endpoint** by updating the `OLLAMA_URL` to match your setup
4. **Test the models** using your existing Python verification code to ensure the models are available

## Key Benefits:

- **Real-time LLM assistance** integrated directly into Oxygen XML Editor
- **Context-aware processing** using the current document content
- **Custom UI components** for seamless user interaction
- **Extensible architecture** for adding new LLM-powered features
- **Menu integration** for easy access to common tasks

The plugin leverages your existing Ollama setup and provides a native integration within Oxygen XML Editor's interface.

---

