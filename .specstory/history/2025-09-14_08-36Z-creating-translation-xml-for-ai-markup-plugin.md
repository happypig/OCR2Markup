<!-- Generated by SpecStory -->

# Creating translation.xml for AI Markup plugin (2025-09-14 08:36Z)

_**User (2025-09-14 08:39Z)**_

prepare a translation.xml by refering to the link: https://www.oxygenxml.com/doc/versions/27.1/ug-editor/topics/contribute-new-languages-extension.html

---

_**Assistant**_

I will create a `translation.xml` file for internationalization and update the JavaScript file to use translated strings.

### Create `c:\Project\OCR2Markup\Models\Gemini2.5\dilaAIMarkupPlugin\translation.xml`

This new file will contain the English and Traditional Chinese translations for the user interface strings.

````xml
<?xml version="1.0" encoding="UTF-8"?>
<translation>
    <language code="en_US">
        <key name="actions.menu">Actions</key>
        <key name="ai.markup.action">AI Markup</key>
        <key name="tag.removal.action">Tag Removal</key>
        <key name="options.menu">Options</key>
        <key name="settings.action">Settings</key>
        <key name="initial.info">Please select a function from the Actions menu, or select Settings from the Options menu to configure parameters.</key>
        <key name="replace.button">Replace</key>
        <key name="view.title">DILA AI Markup Assistant</key>
        <key name="action.ai.markup.selected">Action selected: AI Markup (Use AI for reference tagging)\n</key>
        <key name="system.prompt.ai.markup">Please add XML tags for all sutra, volume, page, column, and line references related to "sutra references" in the selected text.</key>
        <key name="llm.error">Error calling language model: </key>
        <key name="text.replaced">Selected text has been replaced.</key>
        <key name="text.mode.not.active.for.replace">Text mode editor is not open. Please switch to text mode to use this feature.</key>
        <key name="error.replacing.text">Error during text replacement: </key>
        <key name="text.editor.not.open">Text mode editor is not open.</key>
        <key name="no.text.to.replace">No text to replace.</key>
        <key name="action.tag.removal.selected">Action selected: Tag Removal (Remove tags from selected text).\n</key>
        <key name="action.settings.selected">Option selected: Settings (Configure parameters).\n\nThis feature is pending implementation.</key>
        <key name="selected.text.label">\nSelected text: </key>
        <key name="no.text.selected">[FND]No text selected in the editor.</key>
        <key name="not.text.mode">[FND]Current page is not a Text mode editor.</key>
        <key name="no.editor.open">[FND]No open Text mode editor.</key>
    </language>
    <language code="zh_TW">
        <key name="actions.menu">Actions</key>
        <key name="ai.markup.action">AI Markup</key>
        <key name="tag.removal.action">Tag Removal</key>
        <key name="options.menu">Options</key>
        <key name="settings.action">Settings</key>
        <key name="initial.info">請從Actions菜單選擇功能，或從Options菜單選擇Settings以設定參數。</key>
        <key name="replace.button">Replace</key>
        <key name="view.title">DILA AI Markup Assistant</key>
        <key name="action.ai.markup.selected">選取Action: AI Markup (用 AI 作參照標記)\n</key>
        <key name="system.prompt.ai.markup">請將選取文字中，只要與「藏經參照」相關的藏經、冊、頁、欄、行等均標上 XML 標籤。</key>
        <key name="llm.error">呼叫語言模型發生錯誤: </key>
        <key name="text.replaced">\n選取文字已替換。</key>
        <key name="text.mode.not.active.for.replace">\n文字模式編輯器未開啟，請切換到文字模式再使用。</key>
        <key name="error.replacing.text">\n替換文字時發生錯誤: </key>
        <key name="text.editor.not.open">Text 模式編輯器未開啟。</key>
        <key name="no.text.to.replace">無文字可替換。</key>
        <key name="action.tag.removal.selected">選取Action: Tag Removal (移除選取文字的標記)。\n</key>
        <key name="action.settings.selected">選取 Option: Settings (設定參數)。\n\n此為待完成功能</key>
        <key name="selected.text.label">\n選取文字: </key>
        <key name="no.text.selected">[FND]編輯器內未選取文字.</key>
        <key name="not.text.mode">[FND]當前頁面不是Text模式編輯器.</key>
        <key name="no.editor.open">[FND]目前沒有開啟的Text模式編輯器.</key>
    </language>
</translation>
````

### [dila-ai-markup.js](file:///c%3A/Project/OCR2Markup/Models/Gemini2.5/dilaAIMarkupPlugin/dila-ai-markup.js)

I will update the script to use the `pluginWorkspaceAccess.getI18n()` method to fetch translated strings from `translation.xml`, replacing hardcoded UI text.

````javascript
// ...existing code...
// This is called by Oxygen when the plugin is initialized.
function applicationStarted(pluginWorkspaceAccess) {


    // Check for DEBUG setting from environment variable or system property
    var DEBUG = getDebugMode();
    var i18n = pluginWorkspaceAccess.getI18n.bind(pluginWorkspaceAccess);

    // Add a view component customizer
    pluginWorkspaceAccess.addViewComponentCustomizer(new JavaAdapter(
// ...existing code...
            customizeView: function(viewInfo) {
                if ("dila.ai.markup.view" == viewInfo.getViewID()) {
          
                    // Create a simple UI for the view
                    var JMenuBar = Packages.javax.swing.JMenuBar;
                    var JMenu = Packages.javax.swing.JMenu;
                    var JMenuItem = Packages.javax.swing.JMenuItem;
                    var menuBar = new JMenuBar();
                    var menuActions = new JMenu(i18n("actions.menu"));
                    var menuItemActionAIMarkup = new JMenuItem(i18n("ai.markup.action")); // load action from local
                    var menuItemActionTagRemoval = new JMenuItem(i18n("tag.removal.action")); // load action from local
                    var menuOptions = new JMenu(i18n("options.menu"));
                    var menuItemOption = new JMenuItem(i18n("settings.action")); // go to options dialog

                    // Assemble the menu bar
                    menuBar.add(menuActions);
// ...existing code...
                    var JScrollPane = Packages.javax.swing.JScrollPane;
                    var JSplitPane = Packages.javax.swing.JSplitPane;

                    var infoArea = new JTextArea(i18n("initial.info"), 4, 0);
                    infoArea.setLineWrap(true);
                    infoArea.setWrapStyleWord(true);
// ...existing code...
                    mainPanel.add(splitPane, BorderLayout.CENTER);

                    var JButton = Packages.javax.swing.JButton;
                    var buttonPanel = new JPanel();
                    var replaceButton = new JButton(i18n("replace.button"));
                    buttonPanel.add(replaceButton);
                    buttonPanel.setComponentOrientation(Packages.java.awt.ComponentOrientation.RIGHT_TO_LEFT);
// ...existing code...
                    buttonPanel.setVisible(false);

                    // Set the component and title for the view
                    viewInfo.setComponent(mainPanel);
                    viewInfo.setTitle(i18n("view.title"));

                    // Add action listeners to menu items
                    menuItemActionAIMarkup.addActionListener(function(e) {
                        logDebug("AI Markup action triggered");
                        infoArea.setText(i18n("action.ai.markup.selected"));
                        var selectedText = fetchAndDisplaySelectedText(infoArea);

                        // Send selectedText to LLM and handle response
// ...existing code...
                                    connection.setDoOutput(true);
                                    
                                    // Define the system prompt to guide the AI's response.
                                    var systemPrompt = i18n("system.prompt.ai.markup");

                                    // Prepare request payload
                                    var requestBody = JSON.stringify({
// ...existing code...
                                        SwingUtilities.invokeLater(function() {
                                            resultArea.setText("<ref>" + llmResponse + "</ref>");
                                            buttonPanel.setVisible(true);
// ...existing code...
                                        throw new Error("HTTP " + responseCode + ": " + errorResponse);
                                    }
                                    
                                } catch (error) {
                                    // --- Schedule error message update back on the EDT ---
                                    SwingUtilities.invokeLater(function() {
                                        infoArea.setText(i18n("llm.error") + error.message);
                                        logDebug("LLM API Error: " + error);
                                    });
                                }
// ...existing code...
                                                logDebug("Original text removed");
                                                // theDocument.insertString(selectionStart, replacementText, null);
                                                theDocument.insertString(selectionStart, replacementText, null);
                                                logDebug("Text replaced in document.");
                                                infoArea.append(i18n("text.replaced"));
                                            } finally {
                                                pageAccess.endCompoundUndoableEdit();
                                                buttonPanel.setVisible(false);
                                            }
                                        } else {
                                            infoArea.append(i18n("text.mode.not.active.for.replace"));
                                        }
                                    } catch (error) {
                                        infoArea.append(i18n("error.replacing.text") + error.message);
                                        logDebug("Error during text replacement: " + error);
                                    }
                                }
                            } else {
                                infoArea.append(i18n("text.editor.not.open"));
                            }
                        } else {
                            infoArea.append(i18n("no.text.to.replace"));
                        }
                    });

                    menuItemActionTagRemoval.addActionListener(function(e) {
                        logDebug("Tag Removal action triggered");
                        infoArea.setText(i18n("action.tag.removal.selected"));
                        var selectedText = fetchAndDisplaySelectedText(infoArea);
                        if (selectedText && selectedText.length() > 0) {
// ...existing code...
                        }
                    });
                    menuItemOption.addActionListener(function(e) {
                        logDebug("Settings option triggered");
                        infoArea.setText(i18n("action.settings.selected"));
                        // pluginWorkspaceAccess.showOptionsDialog("DILA AI Markup Assistant Settings", "dila.ai.markup.assistant");
                        buttonPanel.setVisible(false);
                   });
// ...existing code...
        }
    ))

    function fetchAndDisplaySelectedText(area) {
        var editorAccess = pluginWorkspaceAccess.getCurrentEditorAccess(Packages.ro.sync.exml.workspace.api.PluginWorkspace.MAIN_EDITING_AREA);
        if (editorAccess != null) {
            var pageAccess = editorAccess.getCurrentPage();
            if (pageAccess != null && pageAccess instanceof Packages.ro.sync.exml.workspace.api.editor.page.text.WSTextEditorPage) {
                var textPageAccess = pageAccess;
                var selectedText = textPageAccess.getSelectedText();
                if (selectedText != null && selectedText.length() > 0) {
                    area.append(i18n("selected.text.label") + selectedText);
                    return selectedText;
                } else {
                    area.append(i18n("no.text.selected"));
                    return "";
                }
            } else {
                area.append(i18n("not.text.mode"));
                return "";
            }
        } else {
            area.append(i18n("no.editor.open"));
            return "";
        }
    }
}



// This is called by Oxygen when the plugin is being disposed.
// ...existing code...
````

---

